<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for Andela-Developer-Challenge/app/controller/entryController.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">Andela-Developer-Challenge/app/controller/</a> entryController.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">80.81% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>80/99</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">72.09% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>31/43</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>15/15</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">80% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>76/95</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import pool from '../db/pool';
&nbsp;
const badRequest = { status: 400, message: 'Bad Request' };
&nbsp;
const isEditable = (req) =&gt; {
  pool.query('SELECT EXTRACT (day FROM time_created) as day, EXTRACT (month FROM time_created) as month, EXTRACT (isoyear FROM time_created) as year FROM entries WHERE id = $1', [req.params.id], (error, response) =&gt; {
    if (response.rows[0] !== undefined) {
      const date = new Date();
      const currentDay = date.getDate();
      const currentMonth = date.getMonth() + 1;
      const currentYear = date.getFullYear();
&nbsp;
      const createdDay = response.rows[0].day;
      const createdMonth = response.rows[0].month;
      const createdYear = response.rows[0].year;
&nbsp;
      const dayDiff = createdDay - currentDay;
      const monthDiff = currentMonth - createdMonth;
      const yearDiff = createdYear - currentYear;
&nbsp;
&nbsp;
      if (<span class="missing-if-branch" title="else path not taken" >E</span>dayDiff === 0 &amp;&amp; monthDiff === 0 &amp;&amp; yearDiff === 0) {
        return true;
      }
      return <span class="cstat-no" title="statement not covered" >false;</span>
    }
    return false;
  });
};
&nbsp;
const getEntry = (req, res) =&gt; {
  pool.query('SELECT * FROM entries WHERE (id, user_id) = ($1, $2)', [req.params.id, req.userData.userId], (err, dbRes) =&gt; {
    if (<span class="missing-if-branch" title="if path not taken" >I</span>err) {
      const <span class="cstat-no" title="statement not covered" >reply = { status: '500', message: 'Internal Server Error', description: 'Could not retrieve entry' };</span>
      res.<span class="cstat-no" title="statement not covered" >status(500).send(reply);</span>
    } else {
      // console.log(dbRes.rows[0]);
      const reply = {
        status: '404', message: 'Entry Not Found',
      };
      if (dbRes.rows[0] === undefined) {
        res.status(404).send(reply);
      } else {
        const goodReply = { status: '200', message: 'Entry returned successfully', entry: dbRes.rows[0] };
        res.status(200).send(goodReply);
      }
    }
  });
};
&nbsp;
const getEntries = (req, res) =&gt; {
  pool.query('SELECT * FROM entries WHERE user_id = ($1) ORDER BY id DESC', [req.userData.userId], (err, dbRes) =&gt; {
    if (<span class="missing-if-branch" title="if path not taken" >I</span>err) {
      // console.log(err.stack);
      const <span class="cstat-no" title="statement not covered" >reply = { status: '500', message: 'Internal Server Error', description: 'Could not retrieve entry' };</span>
      res.<span class="cstat-no" title="statement not covered" >status(500).send(reply);</span>
    } else {
      const db = { entries: dbRes.rows, size: dbRes.rows.length };
      const reply = {
        status: '404', message: 'There is no entries yet',
      };
      if (dbRes.rows === undefined || dbRes.rows.length === 0) {
        res.status(404).send(reply);
      } else {
        // console.log(dbRes.rows);
        const goodReply = { status: '200', message: 'Entries returned successfully', data: db };
        res.status(200).send(goodReply);
      }
    }
  });
};
&nbsp;
const createEntry = (req, res) =&gt; {
  if (req.body.text == null || req.body.title == null) {
    badRequest.description = 'Body or title cannot be empty';
    res.status(400).send(badRequest);
  } else {
    pool.query('INSERT INTO entries(title, description, user_id) values($1, $2, $3)',
      [req.body.title, req.body.text, req.userData.userId], (error) =&gt; {
        if (error) {
          const replyServer = { status: '500', message: 'Internal Server Error', description: 'Could not post entry' };
          res.status(500).send(replyServer);
        } else {
          pool.query('SELECT * FROM entries WHERE user_id = ($1) ORDER BY id DESC', [req.userData.userId], (err, dbRes) =&gt; {
            if (<span class="missing-if-branch" title="if path not taken" >I</span>err) {
              const <span class="cstat-no" title="statement not covered" >reply = { status: '500', message: 'Internal Server Error', description: 'Could not retrieve entry' };</span>
              res.<span class="cstat-no" title="statement not covered" >status(500).send(reply);</span>
            } else {
              const db = { entries: dbRes.rows, size: dbRes.rows.length };
              const reply = { status: '404', message: 'Entry Not Inserted' };
              if (<span class="missing-if-branch" title="if path not taken" >I</span>dbRes.rows === undefined) {
                res.<span class="cstat-no" title="statement not covered" >status(404).send(reply);</span>
              } else {
                const goodReply = { status: '201', message: 'Entry Created successfully', data: db };
                res.status(201).send(goodReply);
              }
            }
          });
        }
      });
  }
};
&nbsp;
const updateEntry = (req, res) =&gt; {
  if (<span class="missing-if-branch" title="else path not taken" >E</span>!isEditable(req)) {
    pool.query('UPDATE entries SET title = ($1), description = ($2) WHERE (id, user_id) = ($3, $4)',
      [req.body.title, req.body.text, req.params.id, req.userData.userId], (error) =&gt; {
        if (<span class="missing-if-branch" title="if path not taken" >I</span>error) {
          const <span class="cstat-no" title="statement not covered" >replyServer = { status: '500', message: 'Internal Server Error', description: 'Could not update entry' };</span>
          res.<span class="cstat-no" title="statement not covered" >status(500).send(replyServer);</span>
        } else {
          pool.query('SELECT * FROM entries WHERE user_id = ($1) ORDER BY id DESC', [req.userData.userId], (err, dbRes) =&gt; {
            if (<span class="missing-if-branch" title="if path not taken" >I</span>err) {
              const <span class="cstat-no" title="statement not covered" >reply = { status: '500', message: 'Internal Server Error', description: 'Could not retrieve entry' };</span>
              res.<span class="cstat-no" title="statement not covered" >status(500).send(reply);</span>
            } else {
              const db = { entries: dbRes.rows, size: dbRes.rows.length };
              const reply = { status: '404', message: 'Entry Not Found' };
              if (<span class="missing-if-branch" title="if path not taken" >I</span>dbRes.rows === undefined) {
                res.<span class="cstat-no" title="statement not covered" >status(404).send(reply);</span>
              } else {
                const goodReply = { status: '200', message: 'Entry Modified successfully', data: db };
                res.status(200).send(goodReply);
              }
            }
          });
        }
      });
  } else {
    const <span class="cstat-no" title="statement not covered" >Reply = { status: '200', message: 'Entry can not be modified' };</span>
    res.<span class="cstat-no" title="statement not covered" >status(200).send(Reply);</span>
  }
};
&nbsp;
const deleteEntry = (req, res) =&gt; {
  let reply = {};
  pool.query('DELETE FROM entries WHERE (id, user_id) = ($1, $2)', [req.params.id, req.userData.userId], (err, result) =&gt; {
    if (<span class="missing-if-branch" title="if path not taken" >I</span>err) {
      reply = <span class="cstat-no" title="statement not covered" >{ status: '500', message: 'Internal Server Error', description: 'Could not delete Entry' };</span>
      res.<span class="cstat-no" title="statement not covered" >status(500).send(reply);</span>
    } else {
      pool.query('SELECT * FROM entries WHERE user_id = ($1) ORDER BY id DESC', [req.userData.userId], (error, dbRes) =&gt; {
        if (<span class="missing-if-branch" title="if path not taken" >I</span>error) {
          res.<span class="cstat-no" title="statement not covered" >status(500).send(reply);</span>
        } else {
          const db = { entries: dbRes.rows, size: dbRes.rows.length };
          const badReply = { status: '404', message: 'Entry Not Found' };
          if (<span class="missing-if-branch" title="if path not taken" >I</span>dbRes.rows === undefined) {
            res.<span class="cstat-no" title="statement not covered" >status(404).send(badReply);</span>
          } else {
            const goodReply = { status: '200', message: 'Entry Deleted successfully', data: db };
            if (result.rowCount === 0) {
              const badDeleteReply = { status: '404', message: 'Entry does not exist' };
              res.status(200).send(badDeleteReply);
            } else {
              res.status(200).send(goodReply);
            }
          }
        }
      });
    }
  });
};
&nbsp;
export {
  getEntry, getEntries, createEntry, updateEntry, deleteEntry,
};
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Aug 15 2018 02:40:58 GMT+0100 (WAT)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
